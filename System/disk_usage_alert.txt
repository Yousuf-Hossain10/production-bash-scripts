#!/bin/bash
set -euo pipefail

#############################################
# Author      : Yousuf Hossain
# Script Name : disk_usage_alert.sh
# Description : Alerts when disk usage exceeds threshold
# Usage       : ./disk_usage_alert.sh
#############################################

THRESHOLD=80
LOG_FILE="/var/log/disk_usage_alert.log"

log() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" | tee -a "$LOG_FILE"
}

check_disk_usage() {
    df -hP | awk 'NR>1 {print $5 " " $6}' | while read -r usage mount; do
        usage_percent=${usage%\%}

        if (( usage_percent >= THRESHOLD )); then
            log "WARNING: Disk usage on $mount is ${usage_percent}%"
        fi
    done
}

main() {
    log "Starting disk usage check (threshold=${THRESHOLD}%)"
    check_disk_usage
    log "Disk usage check completed"
}

main
